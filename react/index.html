<html>
<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.2.1/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.2.1/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
    <script type="text/babel">

   	var users = [{
   		id: 1,
   		name: "John"
   	}, {
   		id: 2,
   		name: "Bob"
   	}, {
   		id: 3,
   		name: "Steve"
   	}];

    class User extends React.Component {
        constructor(props) {
            super(props);
            this.state = {
                showEdit: false,
                userName: props.userName,
                id: props.id
            };
            this.onRemoveClick = this.onRemoveClick.bind(this);
            this.onEditClick = this.onEditClick.bind(this);
            this.onSaveClick = this.onSaveClick.bind(this);
            this.onTextBoxChange = this.onTextBoxChange.bind(this);
        }

    	render() {
    		return (
    			<div className="user">
                    {!this.state.showEdit
                        ? <span>{this.state.id}. {this.state.userName}</span>
                        : <input type="text" value={this.state.userName} onChange={this.onTextBoxChange} />
                    }
                    {!this.state.showEdit 
                        ? <button onClick={this.onEditClick}>Edit</button>
                        : <button onClick={this.onSaveClick}>Save</button>
                    }
                    <button onClick={this.onRemoveClick}>Remove</button>
    			</div>
    		);
    	}

        onRemoveClick() {
            this.props.removeUser(this.state.id);
        }

        onEditClick() {
            this.setState({
                showEdit: true
            });
        }

        onTextBoxChange(e) {
            this.setState({
                showEdit: this.state.showEdit,
                userName: e.target.value,
                id: this.state.id
            });
        }

        onSaveClick() {
            this.props.editUser({
                id: this.state.id,
                name: this.state.userName
            });

            this.setState({
                showEdit: false
            });
        }
    }

    class UsersList extends React.Component {
    	render() {
    		var usersNodes = this.props.users.map(user => {
    			return (
    				<User userName={user.name} key={user.id} id={user.id} removeUser={this.props.removeUser} editUser={this.props.editUser} />
    			);
    		});

    		return (
    			<div className="usersList">
    				{usersNodes}
    			</div>
    		);
    	}
    }

    class UserAdd extends React.Component {
        constructor() {
            super();
            this.state = {
                userName: ""
            };

            this.onTextBoxChange = this.onTextBoxChange.bind(this);
            this.onButtonClick = this.onButtonClick.bind(this);
        }

    	render() {
    		return (
    			<div>
    				<span> Enter user name: </span>
    				<input type="text" value={this.state.userName} onChange={this.onTextBoxChange}></input>
    				<button onClick={this.onButtonClick}>Add</button>
    			</div>
    		);
    	}

        onTextBoxChange(e) {
            this.setState({userName: e.target.value});
        }

        onButtonClick() {
            this.props.addHandler(this.state.userName);
        }
    }

    class UsersBox extends React.Component {
    	constructor() {
    		super();
    		this.state = {
    			users: []
    		};

            this.addUser = this.addUser.bind(this);
            this.removeUser = this.removeUser.bind(this);
            this.editUser = this.editUser.bind(this);
    	}
    	render() {
    		return (
    			<div>
    				<h1> Users: </h1>
    				<UserAdd addHandler={this.addUser} />
    				<UsersList users={this.state.users} removeUser={this.removeUser} editUser={this.editUser} />
    			</div>
    		);
    	}

    	addUser(user) {
            var users = this.state.users;
            var newId = -1;
            if (users.length === 0) {
                newId = 0;
            } else {
                var lastUser = users[users.length - 1];
                newId = lastUser.id + 1;
            }  
    		users.push({
                id: newId,
                name: user
            });

            this.setState({
                users: users
            });
    	}	

        removeUser(id) {
            this.setState({
                users: this.state.users.filter(u => u.id !== id)
            });
        }

        editUser(user) {
            var currentUser = this.state.users.find(u => u.id === user.id)
            currentUser.name = user.name;

            this.setState({
                users: this.state.users
            });
        }
    }

    ReactDOM.render(
    	<UsersBox />,
    	document.getElementById("container")
    	);
    </script>
</head>
<body>
	<div id="container" />
</body>
</html>